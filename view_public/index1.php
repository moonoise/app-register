<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="en">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>สมาคมศิษย์เก่าวิศวกรรมชลประทาน ในพระบรมราชูปถัมภ์</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />

    <!-- Disable tap highlight on IE -->
    <meta name="msapplication-tap-highlight" content="no">

    <link rel="stylesheet" href="../assets/css/base.min.css">

    <style>
        .bg-premium-dark {
            background-image: linear-gradient(to right, #660000 0, #000 100%) !important;

        }

        .text-color {
            /* color: linear-gradient(to right, #660000 0, #000 100%) !important; */
            font-size: 30px;
            background: -webkit-linear-gradient(#f9f5f5, #f3dada);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .text-color-white {
            /* color: linear-gradient(to right, #660000 0, #000 100%) !important; */

            background: -webkit-linear-gradient(#f9f5f5, #f3dada);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }


        .widget-chart .widget-numbers {

            line-height: 2;
        }

        body {
            padding-top: 40px;
            padding-bottom: 40px;
            position: relative;
        }

        body::before {
            background: url('../assets/images/bg3s.jpg') no-repeat center center fixed;
            content: '';
            z-index: -1;
            width: 100%;
            height: 100%;
            position: absolute;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            -webkit-filter: blur(2px);
            -moz-filter: blur(2px);
            -o-filter: blur(2px);
            -ms-filter: blur(2px);
            filter: blur(2px);
        }

        .app-theme-white.app-container {
            background: #f1f4f600;
        }

        .icon-wrapper {
            width: 154px;
            height: 155px;
        }

        .icon-wrapper i {
            font-size: 4.7rem;
        }
    </style>

</head>

<body>

    <div class="app-container app-theme-white body-tabs-shadow ">
        <div class="app-container">
            <div class="h-100 ">
                <div class="d-flex h-100 justify-content-center align-items-center">
                    <div class="app-login-box col-md-12">
                        <div class="app-logo-inverse mx-auto mb-3"></div>
                        <!-- ส่วนของปุ่ม -->
                        <div class="row">
                            <div class="col-lg-3 col-xl-3 col-md-3 col-sm-3">

                            </div>
                            <div class="col-lg-6 col-xl-6 col-md-6 col-sm-6">
                                <div class="main-card mb-3 card">

                                    <div class="grid-menu grid-menu-2col">
                                        <div class="no-gutters row">
                                            <div class="col-12">
                                                <h1 class="mt-2 ml-2 text-danger text-center">
                                                    ลงทะเบียน
                                                </h1>
                                                <h5 class="mt-2 ml-2 text text-danger text-center">สมาคมศิษย์เก่าและบุคคลทั่วไปลงทะเบียนร่วมงาน วันชูชาติ 4 มกราคม 2563 <br>และร่วมลุ้นของภายในงาน</h5>
                                            </div>

                                            <div class="col-6">
                                                <div class="widget-chart widget-chart-hover">
                                                    <a class="btn-icon-vertical btn-square btn-transition br-bl btn btn-outline-link bg-premium-dark " id="btn_call_modal_search">
                                                        <div class="icon-wrapper rounded-circle">
                                                            <div class="icon-wrapper-bg bg-primary"></div>
                                                            <i class="fa fa-street-view icon-gradient bg-warm-flame"></i>
                                                        </div>
                                                        <div class="widget-numbers text-color">ศิษย์เก่า</div>
                                                        <div class="widget-subheading text-color">คลิ๊ก</div>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="widget-chart widget-chart-hover">
                                                    <a href="form_guest.php" class="btn-icon-vertical btn-square btn-transition br-bl btn btn-outline-link bg-premium-dark">
                                                        <div class="icon-wrapper rounded-circle">
                                                            <div class="icon-wrapper-bg bg-primary"></div>
                                                            <i class="fa fa-child icon-gradient bg-warm-flame"></i>
                                                        </div>
                                                        <div class=" widget-numbers  text-color">ทั่วไป</div>
                                                        <div class="widget-subheading text-color">คลิ๊ก</div>

                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 col-xl-3 col-md-3 col-sm-3">
                            </div>
                        </div>
                        <div class="text-center text-white opacity-8 mt-3">Copyright © สมาคมศิษย์เก่าวิศวกรรมชลประทาน ในพระบรมราชูปถัมภ์ 2020</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- modal -->
    <div id="modal_search" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content ">
                <div class="modal-header bg-premium-dark">
                    <h5 class="modal-title text-danger text-color-white" id="exampleModalLongTitle">ลงทะเบียนเข้างาน สำหรับศิษย์เก่า</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <form class="" id="form_search" name="form_search">
                                <span class="text">ค้นหาโดยการใส่ ชื่อ หรือ สกุล สามารถใส่อย่างใดอย่างหนึ่งก็ได้</span>
                                <div class="form-row">
                                    <div class="col-md-6">
                                        <div class="position-relative form-group">
                                            <input name="search_fname" id="search_fname" placeholder="ชื่อ" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="position-relative form-group">
                                            <input name="search_lname" id="search_lname" placeholder="สกุล" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <!-- <div class="col-md-6">
                                        <div class="position-relative form-group col-md-6">
                                            <label for="district" class="">
                                                <span class="text-danger"></span>เลขชลกร :</label>
                                            <input name="id2" id="id2" placeholder="" type="text" class="form-control">
                                        </div>
                                    </div>
                                    <div class="col-md-6"></div> -->

                                    <button class="mt-1 btn-sm mb-2 mr-2 btn-icon btn-pill btn btn-primary" id="btn_select_alumni" type="submit"><i class="pe-7s-search btn-icon-wrapper"> </i>
                                        ค้นหา</button>
                                </div>
                            </form>
                        </div>
                        <div class="divider"></div>
                        <div class="col-md-12">
                            <table style="width: 100%;" id="table_search" class="table table-hover table-striped table-bordered for-this-table ">
                                <thead>
                                    <tr class="text-center">
                                        <th scope="col" class="text-center">รุ่น</th>
                                        <th scope="col" class="text-center">ชื่อ - สกุล</th>
                                        <th scope="col" class="text-center">#</th>
                                    </tr>
                                </thead>
                                <tbody id="id-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>
    <!-- modal -->

    <?php include_once "../layouts/6-script-include.php"; ?>
    <!--SCRIPTS INCLUDES-->

    <script>
        $("#btn_call_modal_search").on("click", function() {
            $("#modal_search").modal({
                show: true,
                keyboard: false,
                backdrop: 'static'
            })
        });


        $("#form_search").submit(function(e) {
            e.preventDefault();
            $.ajax({
                type: "POST",
                url: "../query_alumni/alumni_register_search.php",
                data: $("#form_search").serialize(),
                dataType: "JSON",
                success: function(response) {
                    if (Object.keys(response).length > 0) {
                        if (response.register == false) {
                            $("#id-tbody").html("<tr><td>" + response.data.id2 + "</td><td> คุณ" + response.data.std_fname_th + " " + response.data.std_lname_th + "</td><td><button class=\"btn btn-info btn-sm\" id=\"id-regis\" value=\"" + response.data.ku_id_auto + "\">ลงทะเบียน</button></td></tr>");
                        } else if (response.register == true) {
                            $("#id-tbody").html("<tr><td></td><td></td><td><span class=\"text text-success text-center\"> ลงทะเบียนแล้ว </span></td></tr>");
                        } else {
                            $("#id-tbody").html("<tr><td colspan = \"3\"  class=\"text-center\">ไม่พบข้อมูล</td></tr>");
                        }

                    } else {
                        $("#id-tbody").html("<tr><td colspan = \"3\" class=\"text-center\">ไม่พบข้อมูล</td></tr>");
                    }
                }
            });
        });


        $(document).on("click", "#id-regis", function() {
            swal.fire({
                title: "ลงทะเบียนเข้างาน",
                text: "",
                type: "warning",
                showCancelButton: true,
                cancelButtonColor: "#d92550",
                cancelButtonText: "ยกเลิก",
                confirmButtonColor: "#3085d6",
                confirmButtonText: "ลงทะเบียน",
                html: false
            }).then((result) => {
                if (result.value) {
                    console.log($(this).val())
                    $.ajax({
                        type: "POST",
                        url: "../query_alumni/alumni_register_update.php",
                        data: {
                            "ku_id_auto": $("#id-regis").val()
                        },
                        dataType: "JSON",
                        success: function(response) {
                            if (response.success == true) {
                                Swal.fire(
                                    'ลงทะเบียนสำเร็จ',
                                    ':)',
                                    'success'
                                )
                                $("#modal_search").modal('hide')
                                $('#form_search')[0].reset();
                                $("#id-tbody").html("");
                            } else {
                                Swal.fire(
                                    'Error',
                                    'เกิดข้อผิดพลาด :)',
                                    'error'
                                )
                            }
                        }
                    });

                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    console.log("cancel")

                }
            });
        });


        // var dataTables = [{
        //     "batch": "",
        //     "std_fullname": "",
        //     "button_select": ""
        // }];

        // var table = $('#table_search').DataTable({
        //     "data": dataTables,
        //     "deferRender": true,
        //     "autoWidth": false,
        //     "columns": [{
        //             "data": "batch"
        //         },
        //         {
        //             "data": "std_fullname"
        //         },
        //         {
        //             "data": "button_select"
        //         }
        //     ],
        //     "columnDefs": [{
        //             "targets": ["batch"],
        //             "searchable": true
        //         },
        //         {
        //             "targets": ["std_fullname"],
        //             "searchable": true
        //         },
        //         {
        //             "targets": ["button_select"],
        //             "searchable": false
        //         }
        //     ],
        //     'pageLength': 25,
        //     "lengthMenu": [
        //         [10, 25, 50, 100, -1],
        //         [10, 25, 50, 100, "All"]
        //     ]
        // });
    </script>

</body>

</html>